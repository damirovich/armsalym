<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ARMzalogApp.Views.CheckClientPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Проверка клиента">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <!-- 1. Выбор сервиса -->
            <Label Text="Выберите источник проверки:" />
            <Picker
                Title="Источник"
                ItemsSource="{Binding Services}"
                SelectedItem="{Binding SelectedService}" />


            <!-- 3. Блок ГРС -->
            <VerticalStackLayout Spacing="8"
                                 IsVisible="{Binding IsGrsSelected}">

                <Label Text="Данные паспорта (ГРС IK):"
                       FontAttributes="Bold" />
                <Entry
                    Placeholder="ПИН"
                    Keyboard="Numeric"
                    Text="{Binding Pin}" />

                <Entry
                    Placeholder="Серия паспорта (AA, ID...)"
                    Text="{Binding PassportSeries}" />

                <Entry
                    Placeholder="Номер паспорта"
                    Keyboard="Numeric"
                    Text="{Binding PassportNumber}" />
            </VerticalStackLayout>

            <!-- ========================= -->
            <!--      БЛОК ДЛЯ КИБ         -->
            <!-- ========================= -->
            <VerticalStackLayout Spacing="12"
                     IsVisible="{Binding IsKibSelected}">

                <Label Text="Проверка клиента через КИБ"
           FontAttributes="Bold"
           FontSize="18" />

                <!-- PIN -->
                <Entry
        Placeholder="ПИН клиента"
        Keyboard="Numeric"
        Text="{Binding Pin}" />

                <!-- Тип номера -->
                <Picker Title="Тип номера (IdNumberType)"
            ItemsSource="{Binding KibIdTypes}"
            SelectedItem="{Binding SelectedKibIdType}" />

                <!-- Внутренний паспорт -->
                <Entry
        Placeholder="Серия + номер паспорта (AA1234567)"
        Text="{Binding InternalPassport}" />

                <!-- Дата рождения -->
                <Entry
        Placeholder="Дата рождения (yyyy-MM-dd)"
        Keyboard="Text"
        Text="{Binding DateOfBirth}" />

                <!-- ФИО -->
                <Entry
        Placeholder="ФИО полностью"
        Text="{Binding FullName}" />

                <!-- ZvPozn -->
                <Entry
        Placeholder="Номер заявки (ZvPozn)"
        Keyboard="Numeric"
        Text="{Binding ZvPozn}" />

                <!-- Тип клиента -->
                <Picker Title="Тип клиента"
            ItemsSource="{Binding ClientTypes}"
            SelectedItem="{Binding SelectedClientType}" />

                <!-- UserId -->
                <Entry
        Placeholder="UserId сотрудника"
        Keyboard="Numeric"
        Text="{Binding UserId}" />

                <!-- Результат -->
                <Label Text="{Binding KibShortInfo}"
           TextColor="Green"
           FontAttributes="Italic"
           LineBreakMode="WordWrap" />

            </VerticalStackLayout>

            <!-- 5. Блок Соц-фонда -->
            <VerticalStackLayout Spacing="8"
                     IsVisible="{Binding IsSfSelected}">
                <Label Text="Проверка через Соцфонд"
           FontAttributes="Bold"
           FontSize="18" />

                <!-- ПИН -->
                <Entry
        Placeholder="ПИН"
        Keyboard="Numeric"
        Text="{Binding Pin}" />

                <!-- Номер заявки -->
                <Entry
        Placeholder="Номер заявки (ZvPozn)"
        Keyboard="Numeric"
        Text="{Binding ZvPozn}" />

                <!-- Тип клиента -->
                <Picker Title="Тип клиента"
            ItemsSource="{Binding ClientTypes}"
            SelectedItem="{Binding SelectedClientType}" />

                <!-- Результат -->
                <Label Text="{Binding SfMessage}"
           TextColor="Green"
           FontAttributes="Italic"
           LineBreakMode="WordWrap" />
            </VerticalStackLayout>
            <!-- 6. Кнопка проверки -->
            <Button
                Text="Проверить"
                Command="{Binding CheckCommand}" />

            <!-- 7. Индикатор загрузки -->
            <ActivityIndicator
                IsRunning="{Binding IsBusy}"
                IsVisible="{Binding IsBusy}" />

            <!-- 8. Результат -->
            <Label
                Text="{Binding ResultMessage}"
                FontAttributes="Bold"
                TextColor="Green" />

            <Label
                Text="{Binding LastQuery, StringFormat='Последний запрос: {0:dd.MM.yyyy HH:mm}'}"
                IsVisible="{Binding LastQuery}" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
