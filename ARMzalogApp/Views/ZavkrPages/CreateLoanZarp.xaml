<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ARMzalogApp.Views.ZavkrPages.CreateLoanZarp"
             Title="Зарплатная заявка"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryRed">#D32F2F</Color>

            <Color x:Key="TitleColorLight">#0A63A8</Color>
            <Color x:Key="TitleColorDark">#64B5F6</Color>

            <Style x:Key="SectionTitleStyle" TargetType="Label">
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TitleColorLight}, Dark={StaticResource TitleColorDark}}"/>
                <Setter Property="Margin" Value="5,20,0,8"/>
                <Setter Property="TextTransform" Value="Uppercase"/>
            </Style>

            <Style x:Key="CardStyle" TargetType="Frame">
                <Setter Property="Padding" Value="15"/>
                <Setter Property="CornerRadius" Value="15"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="BorderColor" Value="Transparent"/>
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E1E1E}"/>
                <Setter Property="Margin" Value="0,0,0,5"/>
            </Style>

            <Style x:Key="FieldLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#666666, Dark=#B0B0B0}"/>
                <Setter Property="Margin" Value="2,0,0,2"/>
            </Style>

            <Style x:Key="InputBorderStyle" TargetType="Border">
                <Setter Property="Stroke" Value="{AppThemeBinding Light=#E0E0E0, Dark=#444444}"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
                <Setter Property="Padding" Value="10,0"/>
                <Setter Property="HeightRequest" Value="45"/>
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FAFAFA, Dark=#2C2C2C}"/>
            </Style>

            <Style TargetType="Entry">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}"/>
                <Setter Property="PlaceholderColor" Value="{AppThemeBinding Light=Gray, Dark=#888888}"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

            <Style TargetType="Editor">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}"/>
                <Setter Property="PlaceholderColor" Value="{AppThemeBinding Light=Gray, Dark=#888888}"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

            <Style TargetType="Picker">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}"/>
                <Setter Property="TitleColor" Value="{AppThemeBinding Light=Gray, Dark=#888888}"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

            <Style TargetType="DatePicker">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

        </ResourceDictionary>
    </ContentPage.Resources>
    
    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="5">

            <Label Text="I. Основная информация" Style="{StaticResource SectionTitleStyle}" />

            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Заявление №" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Keyboard="Numeric" Text="{Binding SelectedKlient.ZvNom}" Placeholder="0" />
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Сумма" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Keyboard="Numeric" Text="{Binding SelectedKlient.ZvSum}" Placeholder="0.00" />
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Валюта" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding CurrencyList}"
                                    ItemDisplayBinding="{Binding Name}"
                                    SelectedItem="{Binding SelectedCurrency}"
                                    Title="Выберите валюту"/>
                        </Border>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="0.4*, 0.6*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Срок (мес)" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Keyboard="Numeric" Text="{Binding SelectedKlient.ZvSrok}" Placeholder="12"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Вид кредита" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Picker ItemsSource="{Binding LoanTypeList}"
                                        ItemDisplayBinding="{Binding Name}"
                                        SelectedItem="{Binding SelectedLoanType}"
                                        Title="Вид"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Субпродукт" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding SubProductList}"
                                    ItemDisplayBinding="{Binding Name}"
                                    SelectedItem="{Binding SelectedSubProduct}"
                                    Title="Выберите субпродукт"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Цель кредита" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding PurposesList}"
                                    ItemDisplayBinding="{Binding SNam}"
                                    SelectedItem="{Binding SelectedPurpose}"
                                    Title="Выберите цель"/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>


            <Label Text="II. Паспортные данные" Style="{StaticResource SectionTitleStyle}" />

            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">

                    <VerticalStackLayout>
                        <Label Text="Документ" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SelectedKlient.ZvDok}" Placeholder="ID карта / Паспорт"/>
                        </Border>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="0.3*, 0.7*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Серия" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.ZvSrdok}" Placeholder="ID" HorizontalTextAlignment="Center"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="№ Документа" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.ZvNdok}" Keyboard="Numeric" Placeholder="1234567"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Дата выдачи" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <DatePicker Date="{Binding SelectedKlient.ZvDatevp}" Format="dd.MM.yyyy"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Срок действия" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <DatePicker Date="{Binding SelectedKlient.ZvDokend}" Format="dd.MM.yyyy"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Орган выдачи" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SelectedKlient.ZvMvd}" Placeholder="МКК..."/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>


            <Label Text="III. Клиент" Style="{StaticResource SectionTitleStyle}" />

            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">

                    <VerticalStackLayout>
                        <Label Text="ФИО Клиента" Style="{StaticResource FieldLabelStyle}"/>
                        <Grid ColumnDefinitions="*, Auto" ColumnSpacing="5">
                            <Border Style="{StaticResource InputBorderStyle}" Grid.Column="0">
                                <Entry Text="{Binding KlientFullName}" Placeholder="Фамилия Имя Отчество"/>
                            </Border>
                            <Button Grid.Column="1" 
                                    Text="Найти" 
                                    HeightRequest="45"
                                    CornerRadius="8"
                                    BackgroundColor="#5BCCEB" 
                                    TextColor="White" 
                                    FontAttributes="Bold"
                                    Command="{Binding SearchClientCommand}"/>
                        </Grid>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="ИНН" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SelectedKlient.ZvInn}" Keyboard="Numeric" Placeholder="14 цифр"/>
                        </Border>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="0.3*, 0.7*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Стаж" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.BvRabStaj}" Placeholder="лет"/>
                            </Border>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Должность" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.Doljnoct}" Placeholder="Должность"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Фактический адрес" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}" HeightRequest="80">
                            <Editor Text="{Binding SelectedKlient.FaktAdres}" Placeholder="Адрес проживания" AutoSize="TextChanges"/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>
            <Label Text="IV. Члены семьи" Style="{StaticResource SectionTitleStyle}" />

            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">

                    <VerticalStackLayout>
                        <Label Text="Семейное положение" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding FamilyStatusList}"
                                    ItemDisplayBinding="{Binding Name}"
                                    SelectedItem="{Binding SelectedFamilyStatus}"
                                    Title="Выберите статус"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="ФИО супруга" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SelectedKlient.FioCupr}" Placeholder="Фамилия Имя Отчество"/>
                        </Border>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Место работы супруга" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.RabCupr}" Placeholder="Организация"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Должность супруга" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SelectedKlient.DoljCup}" Placeholder="Должность"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Телефон супруга" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SelectedKlient.BvTelefSupr}" Keyboard="Telephone" Placeholder="+996..."/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>


            <Label Text="V. Финансы (Зарплатный)" Style="{StaticResource SectionTitleStyle}" />

            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">

                    <VerticalStackLayout>
                        <Label Text="Вид клиента" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding ClientTypeList}"
                                     ItemDisplayBinding="{Binding Name}"
                                    SelectedItem="{Binding SelectedClientType}"
                                    Title="Выберите вид"/>
                        </Border>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Заработная плата" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding SalaryAmount}" Keyboard="Numeric" Placeholder="0.00"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Ежемес. расходы" Style="{StaticResource FieldLabelStyle}"/>
                            <Border Style="{StaticResource InputBorderStyle}">
                                <Entry Text="{Binding MonthlyExpenses}" Keyboard="Numeric" Placeholder="0.00"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <VerticalStackLayout>
                        <Label Text="Кредиты Соцфонда" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Entry Text="{Binding SfLoansService}" Keyboard="Numeric" Placeholder="Сумма обслуживания"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Тип дохода" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}">
                            <Picker ItemsSource="{Binding IncomeTypeList}"
                                    ItemDisplayBinding="{Binding Name}"
                                    SelectedItem="{Binding SelectedIncomeType}"
                                    Title="Выберите тип"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Описание дохода" Style="{StaticResource FieldLabelStyle}"/>
                        <Border Style="{StaticResource InputBorderStyle}" HeightRequest="80">
                            <Editor Text="{Binding IncomeDescription}" Placeholder="Детали дохода" AutoSize="TextChanges"/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,20,0,40">
                <Button Grid.Column="0"
                        Text="Отмена"
                        BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}"
                        CornerRadius="25"
                        HeightRequest="50"
                        Command="{Binding BackCommand}"/>

                <Button Grid.Column="1"
                        Text="Сохранить"
                        BackgroundColor="{StaticResource PrimaryRed}"
                        TextColor="White"
                        CornerRadius="25"
                        HeightRequest="50"
                        FontAttributes="Bold"
                        Command="{Binding SaveCommand}"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>